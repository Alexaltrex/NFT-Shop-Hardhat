<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts\NFTShop.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> NFTShop.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>52/52</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">89.58% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>43/48</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>16/16</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>62/62</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">30×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">33×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">32×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">31×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">31×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">17×</span>
<span class="cline-any cline-yes">17×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">17×</span>
<span class="cline-any cline-yes">17×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.9;
&nbsp;
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/token/ERC721/utils/ERC721Holder.sol";
import "./NFTToken.sol";
&nbsp;
contract NFTShop is Ownable, ERC721Holder {
    NFTToken public nftToken;
    // процент от выручки при продажи на аукцион, который перечисляется магазину
    uint public constant FEE = 5;
&nbsp;
    uint _tokenPriceForSell = 90; // цена продажи магазину (wei / 1 Token)
    uint _tokenPriceForBuy = 100; // цена покупки у магазина (wei / 1 Token)
&nbsp;
    struct Auction {
        uint tokenId;
        address seller;
        uint startAt;
        uint price;
    }
&nbsp;
    // массив аукционов
    Auction[] public auctions;
&nbsp;
    // отображение (tokenId =&gt; индекс_аукциона_токена_tokenId_в_массиве_auctions)
    mapping(uint =&gt; uint) auctionsIndex;
    // отображение (tokenId =&gt; выставлен_или_нет_на_аукционе)
    mapping(uint =&gt; bool) tokenOnAuction;
&nbsp;
    event SellPriceChange(uint oldValue, uint newValue, uint timestamp);
    event BuyPriceChange(uint oldValue, uint newValue, uint timestamp);
    event BuyFromShop(address indexed buyer, uint tokenId, uint price, uint timestamp); // покупка токена
    event SellToShop(address indexed seller, uint tokenId, uint price, uint timestamp); // продажа токена
    event AddTokenToAuction(uint tokenId, address seller, uint startAt, uint price); // добавление токена на аукцион
    event RemoveTokenFromAuction(uint tokenId, address seller, uint timestamp); // удаление токена из аукциона
    event BuyTokenFromAuction(uint tokenId, uint price, address buyer, uint timestamp);
&nbsp;
    constructor(uint mintedTokenCount) {
        nftToken = new NFTToken(mintedTokenCount);
        for (uint i = 0; i &lt; mintedTokenCount; i++) {
            nftToken.safeMint(address(this));
        }
    }
&nbsp;
    //========= GET TOKEN PRICE FOR SELL =========//
    function getTokenPriceForSell() public view returns (uint) {
        return _tokenPriceForSell;
    }
&nbsp;
    //========= SET TOKEN PRICE FOR SELL =========//
    function setTokenPriceForSell(uint tokenPriceForSell_) external onlyOwner {
        require(tokenPriceForSell_ != 0, "Token shop: price could not be equal 0");
        emit SellPriceChange(_tokenPriceForSell, tokenPriceForSell_, block.timestamp);
        _tokenPriceForSell = tokenPriceForSell_;
    }
&nbsp;
    //========= GET TOKEN PRICE FOR BUY =========//
    function getTokenPriceForBuy() public view returns (uint) {
        return _tokenPriceForBuy;
    }
&nbsp;
    //========= SET TOKEN PRICE FOR BUY =========//
    function setTokenPriceForBuy(uint tokenPriceForBuy_) external onlyOwner {
        require(tokenPriceForBuy_ != 0, "Token shop: price could not be equal 0");
        emit BuyPriceChange(_tokenPriceForBuy, tokenPriceForBuy_, block.timestamp);
        _tokenPriceForBuy = tokenPriceForBuy_;
    }
&nbsp;
    //========= BUY TOKEN FROM SHOP =========//
    function buyTokenFromShop(uint tokenId) external payable {
        // покупатель прислал необходимое количество денег
        require(msg.value == _tokenPriceForBuy, "Token shop: not enough ethers for buy");
&nbsp;
        // у магазина есть в продаже токен [tokenId]
        require(nftToken.ownerOf(tokenId) == address(this), "NFTShop: shop not an owner of token with this id");
&nbsp;
        // перевод токена [tokenId] из магазина к покупателю
        nftToken.safeTransferFrom(address(this), msg.sender, tokenId);
&nbsp;
        emit BuyFromShop(msg.sender, tokenId, _tokenPriceForBuy, block.timestamp);
    }
&nbsp;
    //========= BUY TOKEN FROM AUCTION =========//
    function buyTokenFromAuction(uint tokenId) external payable {
        // токен должен быть выставлен на аукционе
        require(tokenOnAuction[tokenId], "NFTShop: token not on auction");
&nbsp;
        // покупатель не должен быть владельцем токена (зачем покупать у самого себя)
        address tokenOwner = nftToken.ownerOf(tokenId);
        require(tokenOwner != msg.sender, "NFTShop: buyer could not be a seller");
&nbsp;
        uint price = auctions[auctionsIndex[tokenId]].price;
&nbsp;
        // покупатель прислал необходимое количество денег
        require(msg.value == price, "Token shop: not enough ethers for buy");
&nbsp;
        // магазин имеет разрешение переводить токен от владельца к покупателю
        require(nftToken.getApproved(tokenId) == address(this), "NFTShop: shop has not approval to token");
&nbsp;
        // перевод токена [tokenId] от того, кто выставил его на аукционе к покупателю
        nftToken.safeTransferFrom(tokenOwner, msg.sender, tokenId);
&nbsp;
        // возмещаем тому, кто выставил токен на аукционе, часть выручки (за вычетом % от продажи)
        // price = 95
        // (95 * 5) / 100 = 4.75
        (bool success,) = tokenOwner.call{value : price - ((price * FEE) / 100)}("");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(success, "NFTShop: transfer ether to seller failed");
&nbsp;
        // удалить аукцион из массива аукционов
        _removeTokenFromAuction(tokenId);
&nbsp;
        tokenOnAuction[tokenId] = false;
        emit BuyTokenFromAuction(tokenId, price, msg.sender, block.timestamp);
    }
&nbsp;
    //========= SELL TOKEN TO SHOP =========//
    function sellTokenToShop(uint tokenId) external {
        // продавец токена - владеет им
        require(nftToken.ownerOf(tokenId) == msg.sender, "NFTShop: seller is not an owner of token");
        // магазин имеет разрешение переводить токен от владельца к себе
        require(nftToken.getApproved(tokenId) == address(this), "NFTShop: shop has not approval to token");
        // магазин имеет для покупки достаточное количество эфира
        require(address(this).balance &gt;= _tokenPriceForSell, "NFTShop: shop does not have enough ether");
&nbsp;
        // магазин переводит токены от продавца в магазин
        nftToken.safeTransferFrom(msg.sender, address(this), tokenId);
&nbsp;
        // возмещаем продавцу деньги
        (bool success,) = msg.sender.call{value : _tokenPriceForSell}("");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(success, "NFTShop: transfer ether to seller failed");
&nbsp;
        emit SellToShop(msg.sender, tokenId, _tokenPriceForSell, block.timestamp);
    }
&nbsp;
    //========= ADD TOKEN TO AUCTION =========//
    // выставить токен на аукцион
    function addTokenToAuction(uint tokenId, uint price) external {
        // выставляющий токен на аукцион - владеет им
        require(nftToken.ownerOf(tokenId) == msg.sender, "NFTShop: is not an owner of token");
        // цена не может быть равна 0
        require(price != 0, "NFTShop: price can not be equal 0");
        // токен не дожен быть уже выставлен на аукционе
        require(!tokenOnAuction[tokenId], "NFTShop: token already on auction");
&nbsp;
        // добавляем новый аукцион в auctionsIndex и auctions
        auctionsIndex[tokenId] = auctions.length;
        auctions.push(Auction(
                tokenId,
                msg.sender,
                block.timestamp,
                price
            ));
        tokenOnAuction[tokenId] = true;
        emit AddTokenToAuction(tokenId, msg.sender, block.timestamp, price);
    }
&nbsp;
    //========= REMOVE TOKEN FROM AUCTION =========//
    // удалить токен с аукциона
    function removeTokenFromAuction(uint tokenId) external {
        // аккаунт удаляющий токен с аукциона - владеет им
        require(nftToken.ownerOf(tokenId) == msg.sender, "NFTShop: is not an owner of token");
        // токен уже дожен быть выставлен на аукционе
        require(tokenOnAuction[tokenId], "NFTShop: token not on auction");
&nbsp;
        // удалить аукцион из массива аукционов
        _removeTokenFromAuction(tokenId);
&nbsp;
        tokenOnAuction[tokenId] = false;
        emit RemoveTokenFromAuction(tokenId, msg.sender, block.timestamp);
    }
&nbsp;
    //========= _REMOVE TOKEN FROM AUCTION =========//
    // удалить аукцион из массива аукционов - внутренняя служебная функция
    function _removeTokenFromAuction(uint tokenId) internal {
        // меняем местами последний и удаляемый элемент:
        // значение и индекс удаляемого Auction приравниваются значению и индексу последнего элемента в массиве auctions
        // а последний элемент и его индекс затем удаляются
&nbsp;
        // индекс последнего Auction в массиве auctions
        uint lastAuctionIndex = auctions.length - 1;
        // индекс удаляемого Auction в массиве auctions
        uint deletedIndex = auctionsIndex[tokenId];
&nbsp;
        // значение Auction последнего элемента в массиве auctions
        Auction memory lastAuction = auctions[lastAuctionIndex];
&nbsp;
        // последний Auction в массиве auctions становится на место удаляемого Auction c заданным id
        auctions[deletedIndex] = lastAuction;
        // индекс последнего Auction в массиве auctions теперь равен индексу удаляемого Auction c заданным id
        auctionsIndex[lastAuction.tokenId] = deletedIndex;
&nbsp;
        // обнуляем индекс удаляемого id
        delete auctionsIndex[tokenId];
        // удаляем последний элемент
        auctions.pop();
    }
&nbsp;
    //========= IS TOKEN ON AUCTION =========//
    // возвращает выставлен или нет токен на аукционе
    function isTokenOnAuction(uint tokenId) public view returns (bool) {
        return tokenOnAuction[tokenId];
    }
&nbsp;
    //========= GET AUCTIONS =========//
    function getAuctions() public view returns (Auction[] memory) {
        return auctions;
    }
&nbsp;
    //========= GET AUCTION PRICE =========//
    function getAuctionPrice(uint tokenId) public view returns (uint) {
        if (tokenOnAuction[tokenId] == false) {
            return 0;
        }
        return auctions[auctionsIndex[tokenId]].price;
    }
&nbsp;
    //========= GET SHOP BALANCE =========//
    function getShopBalance() public view <span class="missing-if-branch" title="else path not taken" >E</span>onlyOwner returns (uint) {
        return address(this).balance;
    }
&nbsp;
    //========= WITHDRAW ALL =========//
    function withdrawAll() public <span class="missing-if-branch" title="else path not taken" >E</span>onlyOwner {
        address owner = owner();
        (bool success,) = owner.call{value : address(this).balance}("");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(success, "NFTShop: withdrawAll failed");
    }
&nbsp;
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Apr 20 2023 02:51:27 GMT+0300 (Москва, стандартное время)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
